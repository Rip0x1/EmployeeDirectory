@page
@model EmployeeDirectory.Pages.Print.PrintEmployeesModel
@{
    ViewData["Title"] = "Печать списка сотрудников";
}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Список сотрудников - Печать</title>
    <style>
        @@page {
            size: A4 @(ViewData["Orientation"]);
            margin: 15mm;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: @(ViewData["Scale"])%;
            color: #000 !important;
            background: white;
            margin: 0;
            padding: 0;
            line-height: 1.4;
            font-weight: bold !important;
        }

        
        .department-section {
            margin-bottom: 20px;
            border: 2px solid #000;
            border-radius: 5px;
            overflow: hidden;
            page-break-inside: avoid;
        }
        
        .department-section table {
            page-break-inside: auto;
        }
        
        .department-section thead {
            display: table-header-group;
        }
        
        .department-section tbody {
            display: table-row-group;
        }
        
        .department-section tr {
            page-break-inside: avoid;
            page-break-after: auto;
        }
        
        .department-header {
            background: white !important;
            color: #000 !important;
            padding: 10px;
            font-weight: bold !important;
            font-size: 16px;
            text-align: center;
            border: 2px solid #000 !important;
        }
        
        .print-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
        }
        
        .print-table th {
            background: #000 !important;
            color: white !important;
            padding: 8px;
            text-align: center;
            font-weight: bold !important;
            border: 1px solid #000;
        }
        
        .print-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid #000;
            vertical-align: middle;
            color: #000 !important;
            font-weight: bold !important;
        }
        
        .print-table tr:nth-child(even) td {
            background: #f8f9fa;
        }

        .position-badge {
            background: #e9ecef !important;
            color: #000 !important;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            margin-bottom: 3px;
            display: inline-block;
            font-weight: bold !important;
        }
        
        .employee-name {
            font-weight: bold !important;
            font-size: 12px;
            color: #000 !important;
        }

        @@media print and (orientation: landscape) {
            * {
                box-sizing: border-box !important;
            }
            
            body {
                font-size: 6px !important;
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
                height: 100vh !important;
            }
            
            .print-container {
                display: flex !important;
                flex-direction: row !important;
                width: 100% !important;
                height: 100vh !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            .print-column {
                flex: 0 0 50% !important;
                width: 50% !important;
                max-width: 50% !important;
                height: 100vh !important;
                overflow: hidden !important;
                box-sizing: border-box !important;
                margin: 0 !important;
                padding: 2px !important;
                float: left !important;
                position: relative !important;
            }
            
            .print-column:first-child {
                border-right: 1px solid #ccc !important;
            }
            
            .department-section {
                margin-bottom: 5px !important;
                border: 1px solid #000 !important;
                padding: 1px !important;
            }
            
            .department-header {
                font-size: 8px !important;
                padding: 3px !important;
                margin: 0 !important;
            }
            
            .print-table {
                font-size: 5px !important;
                margin: 0 !important;
            }
            
            .print-table th,
            .print-table td {
                padding: 2px !important;
                font-size: 5px !important;
                line-height: 1.1 !important;
                color: #000 !important;
                font-weight: bold !important;
            }
            
            .position-badge {
                font-size: 3px !important;
                padding: 1px 2px !important;
                margin-bottom: 1px !important;
                color: #000 !important;
                font-weight: bold !important;
            }
            
            .employee-name {
                font-size: 5px !important;
                line-height: 1.1 !important;
                color: #000 !important;
                font-weight: bold !important;
            }
        }

        @@media print and (orientation: portrait) {
            body {
                font-size: 8px !important;
            }
            
            .print-table {
                font-size: 7px !important;
            }
            
            .print-table th,
            .print-table td {
                padding: 3px !important;
                font-size: 6px !important;
                color: #000 !important;
                font-weight: bold !important;
            }
            
            .position-badge {
                font-size: 5px !important;
                padding: 1px 2px !important;
                color: #000 !important;
                font-weight: bold !important;
            }
            
            .employee-name {
                font-size: 7px !important;
                color: #000 !important;
                font-weight: bold !important;
            }
        }
    </style>
</head>
<body>

    @if (Model.Employees.Any())
    {
        <div class="print-container">
            @{
                var groupedEmployees = Model.Employees
                    .GroupBy(e => !string.IsNullOrEmpty(e.DepartmentName) ? e.DepartmentName : e.Department?.Name)
                    .OrderBy(g => g.Key)
                    .ToList();
                
                var orientation = ViewData["Orientation"]?.ToString() ?? "portrait";
                
                if (orientation == "landscape")
                {
                    var allEmployees = groupedEmployees.SelectMany(g => g).ToList();
                    var totalDepartments = groupedEmployees.Count();
                    var halfDepartments = (totalDepartments + 1) / 2;
                    var leftDepartments = groupedEmployees.Take(halfDepartments).ToList();
                    var rightDepartments = groupedEmployees.Skip(halfDepartments).ToList();
                    
                    <div class="print-container">
                        <div class="print-section">
                            @foreach (var departmentGroup in leftDepartments)
                            {
                                <div class="department-section">
                                    <div class="department-header">
                                        @departmentGroup.Key
                                    </div>
                                    
                                    <table class="print-table">
                                        <thead>
                                            <tr>
                                                <th style="width: 40%;">Должность</th>
                                                <th style="width: 20%;">Городской</th>
                                                <th style="width: 20%;">Местный</th>
                                                <th style="width: 20%;">Email</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var employee in departmentGroup)
                                            {
                                                <tr>
                                                    <td>
                                                        @if (!string.IsNullOrEmpty(employee.PositionDescription))
                                                        {
                                                            <div class="position-badge">@employee.PositionDescription</div>
                                                        }
                                                        <br />
                                                        <div class="employee-name">@employee.FullName</div>
                                                    </td>
                                                    <td>@(string.IsNullOrEmpty(employee.CityPhone) ? "Не указано" : employee.CityPhone)</td>
                                                    <td>@(string.IsNullOrEmpty(employee.LocalPhone) ? "Не указано" : employee.LocalPhone)</td>
                                                    <td>@(string.IsNullOrEmpty(employee.Email) ? "Не указано" : employee.Email)</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            }
                        </div>
                        
                        <div class="print-section">
                            @foreach (var departmentGroup in rightDepartments)
                            {
                                <div class="department-section">
                                    <div class="department-header">
                                        @departmentGroup.Key
                                    </div>
                                    
                                    <table class="print-table">
                                        <thead>
                                            <tr>
                                                <th style="width: 40%;">Должность</th>
                                                <th style="width: 20%;">Городской</th>
                                                <th style="width: 20%;">Местный</th>
                                                <th style="width: 20%;">Email</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var employee in departmentGroup)
                                            {
                                                <tr>
                                                    <td>
                                                        @if (!string.IsNullOrEmpty(employee.PositionDescription))
                                                        {
                                                            <div class="position-badge">@employee.PositionDescription</div>
                                                        }
                                                        <br />
                                                        <div class="employee-name">@employee.FullName</div>
                                                    </td>
                                                    <td>@(string.IsNullOrEmpty(employee.CityPhone) ? "Не указано" : employee.CityPhone)</td>
                                                    <td>@(string.IsNullOrEmpty(employee.LocalPhone) ? "Не указано" : employee.LocalPhone)</td>
                                                    <td>@(string.IsNullOrEmpty(employee.Email) ? "Не указано" : employee.Email)</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            }
                        </div>
                    </div>
                                }
                                else
                                {
                    @foreach (var departmentGroup in groupedEmployees)
                    {
                        <div class="department-section">
                            <div class="department-header">
                                @departmentGroup.Key
                            </div>
                            
                            <table class="print-table">
                                <thead>
                                    <tr>
                                            <th style="width: 40%;">Должность</th>
                                        <th style="width: 20%;">Городской</th>
                                        <th style="width: 20%;">Местный</th>
                                        <th style="width: 20%;">Email</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var employee in departmentGroup)
                                    {
                                        <tr>
                                                <td>
                                                    @if (!string.IsNullOrEmpty(employee.PositionDescription))
                                                    {
                                                        <div class="position-badge">@employee.PositionDescription</div>
                                                    }
                                                    <br />
                                                    <div class="employee-name">@employee.FullName</div>
                            </td>
                                            <td>@(string.IsNullOrEmpty(employee.CityPhone) ? "Не указано" : employee.CityPhone)</td>
                                            <td>@(string.IsNullOrEmpty(employee.LocalPhone) ? "Не указано" : employee.LocalPhone)</td>
                                            <td>@(string.IsNullOrEmpty(employee.Email) ? "Не указано" : employee.Email)</td>
                        </tr>
                    }
                </tbody>
            </table>
                        </div>
                    }
                }
            }
        </div>
    }
    else
    {
        <div style="text-align: center; padding: 50px; color: #7f8c8d;">
            <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>
            <p>Сотрудники не найдены</p>
        </div>
    }


    <script>
        window.onload = function() {
            setTimeout(function() {
                window.print();
            }, 500);
        };

        window.addEventListener('afterprint', function() {
            window.close();
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                window.close();
            }
        });
    </script>
</body>
</html>